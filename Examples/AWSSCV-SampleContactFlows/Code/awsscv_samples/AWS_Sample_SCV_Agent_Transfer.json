{
  "ContactFlow": {
    "Name": "AWS_Sample_SCV_Agent_Transfer",
    "Type": "AGENT_TRANSFER",
    "Description": "Modified from: Sample_SCV_Agent_Transfer - Expands on the default Salesforce version by adding a loop around the Telephony Integration Lambda. Also sets the agent transfer to use personal queues instead of the direct connection method.",
    "Content": "{\"Version\":\"2019-10-30\",\"StartAction\":\"fb47cb81-7c12-4ad9-b12f-89f91b840750\",\"Metadata\":{\"entryPointPosition\":{\"x\":15,\"y\":21},\"snapToGrid\":false,\"ActionMetadata\":{\"fb47cb81-7c12-4ad9-b12f-89f91b840750\":{\"position\":{\"x\":17,\"y\":181}},\"66b9f12a-b8b9-4835-9eba-0b837e6cf03d\":{\"position\":{\"x\":540,\"y\":317},\"useDynamic\":false},\"1aac3d82-12e9-4bd9-8340-2c08240e59b7\":{\"position\":{\"x\":780,\"y\":315}},\"2bde5824-af9f-4885-8e5b-70e0db28986f\":{\"position\":{\"x\":294,\"y\":318}},\"1c2943d7-e498-4749-8bf1-a60787516dc2\":{\"position\":{\"x\":1532,\"y\":83},\"useDynamic\":true,\"queue\":\"Agent.UserName\"},\"5e641eb0-0e27-4f78-9e3e-5d8cd35a4ac5\":{\"position\":{\"x\":1824,\"y\":82},\"useDynamic\":false},\"69cf47be-6d08-4d27-9194-e3593d746bd8\":{\"position\":{\"x\":2088.111572265625,\"y\":79.34683227539062},\"useDynamic\":false},\"e28f4da6-59a6-49b8-b14a-041179deb33a\":{\"position\":{\"x\":1319,\"y\":362}},\"bfabe259-f979-46a1-834e-b45d2e38b46b\":{\"position\":{\"x\":1612,\"y\":361}},\"f3aac674-0379-4ba8-8b32-bfd104cd942f\":{\"position\":{\"x\":2065,\"y\":608},\"useDynamic\":false},\"86b37823-c5c6-4f38-91ed-55d0d32071f5\":{\"position\":{\"x\":2375,\"y\":360}},\"a84eafe1-3bf5-4d37-bf24-4d17623bebf5\":{\"position\":{\"x\":1257,\"y\":82}},\"1cfe732c-ec05-4708-bb79-5c3480b0e873\":{\"position\":{\"x\":253,\"y\":43},\"useDynamic\":false},\"b43becd2-b08d-4320-8b7f-a0eadfd42c63\":{\"position\":{\"x\":1033,\"y\":445},\"dynamicMetadata\":{\"methodName\":false},\"useDynamic\":false}}},\"Actions\":[{\"Identifier\":\"fb47cb81-7c12-4ad9-b12f-89f91b840750\",\"Parameters\":{\"RecordingBehavior\":{\"RecordedParticipants\":[\"Agent\",\"Customer\"]}},\"Transitions\":{\"NextAction\":\"1cfe732c-ec05-4708-bb79-5c3480b0e873\",\"Errors\":[],\"Conditions\":[]},\"Type\":\"UpdateContactRecordingBehavior\"},{\"Identifier\":\"66b9f12a-b8b9-4835-9eba-0b837e6cf03d\",\"Parameters\":{\"Text\":\"I'm sorry. We have encountered an error and cannot currently handle your call. Please try back later. We apologize for any inconvenience. Goodbye.\"},\"Transitions\":{\"NextAction\":\"1aac3d82-12e9-4bd9-8340-2c08240e59b7\",\"Errors\":[],\"Conditions\":[]},\"Type\":\"MessageParticipant\"},{\"Identifier\":\"1aac3d82-12e9-4bd9-8340-2c08240e59b7\",\"Type\":\"DisconnectParticipant\",\"Parameters\":{},\"Transitions\":{}},{\"Identifier\":\"2bde5824-af9f-4885-8e5b-70e0db28986f\",\"Parameters\":{\"Attributes\":{\"error_desc\":\"lambda loop fail\",\"process_error\":\"true\"}},\"Transitions\":{\"NextAction\":\"66b9f12a-b8b9-4835-9eba-0b837e6cf03d\",\"Errors\":[{\"NextAction\":\"66b9f12a-b8b9-4835-9eba-0b837e6cf03d\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"UpdateContactAttributes\"},{\"Identifier\":\"1c2943d7-e498-4749-8bf1-a60787516dc2\",\"Parameters\":{\"AgentId\":\"$.Agent.UserName\"},\"Transitions\":{\"NextAction\":\"5e641eb0-0e27-4f78-9e3e-5d8cd35a4ac5\",\"Errors\":[{\"NextAction\":\"bfabe259-f979-46a1-834e-b45d2e38b46b\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"UpdateContactTargetQueue\"},{\"Identifier\":\"5e641eb0-0e27-4f78-9e3e-5d8cd35a4ac5\",\"Parameters\":{\"Text\":\"Transferring now to an Available Agent\"},\"Transitions\":{\"NextAction\":\"69cf47be-6d08-4d27-9194-e3593d746bd8\",\"Errors\":[],\"Conditions\":[]},\"Type\":\"MessageParticipant\"},{\"Identifier\":\"69cf47be-6d08-4d27-9194-e3593d746bd8\",\"Transitions\":{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"Errors\":[{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"ErrorType\":\"NoMatchingError\"},{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"ErrorType\":\"QueueAtCapacity\"}],\"Conditions\":[]},\"Type\":\"TransferContactToQueue\"},{\"Identifier\":\"e28f4da6-59a6-49b8-b14a-041179deb33a\",\"Parameters\":{\"Attributes\":{\"error_desc\":\"set voiceObjectId failed\",\"process_error\":\"true\"}},\"Transitions\":{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"Errors\":[{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"UpdateContactAttributes\"},{\"Identifier\":\"bfabe259-f979-46a1-834e-b45d2e38b46b\",\"Parameters\":{\"Attributes\":{\"error_desc\":\"set Agent Queue failed\",\"process_error\":\"true\"}},\"Transitions\":{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"Errors\":[{\"NextAction\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"UpdateContactAttributes\"},{\"Identifier\":\"f3aac674-0379-4ba8-8b32-bfd104cd942f\",\"Parameters\":{\"Text\":\"I'm sorry. We have encountered an error and cannot currently handle your call. Please try back later. We apologize for any inconvenience. Goodbye.\"},\"Transitions\":{\"NextAction\":\"86b37823-c5c6-4f38-91ed-55d0d32071f5\",\"Errors\":[],\"Conditions\":[]},\"Type\":\"MessageParticipant\"},{\"Identifier\":\"86b37823-c5c6-4f38-91ed-55d0d32071f5\",\"Type\":\"DisconnectParticipant\",\"Parameters\":{},\"Transitions\":{}},{\"Identifier\":\"a84eafe1-3bf5-4d37-bf24-4d17623bebf5\",\"Parameters\":{\"Attributes\":{\"voiceCallId\":\"$.External.voiceCallId\"}},\"Transitions\":{\"NextAction\":\"1c2943d7-e498-4749-8bf1-a60787516dc2\",\"Errors\":[{\"NextAction\":\"e28f4da6-59a6-49b8-b14a-041179deb33a\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"UpdateContactAttributes\"},{\"Identifier\":\"1cfe732c-ec05-4708-bb79-5c3480b0e873\",\"Parameters\":{\"LoopCount\":\"2\"},\"Transitions\":{\"NextAction\":\"2bde5824-af9f-4885-8e5b-70e0db28986f\",\"Errors\":[],\"Conditions\":[{\"NextAction\":\"2bde5824-af9f-4885-8e5b-70e0db28986f\",\"Condition\":{\"Operator\":\"Equals\",\"Operands\":[\"DoneLooping\"]}},{\"NextAction\":\"b43becd2-b08d-4320-8b7f-a0eadfd42c63\",\"Condition\":{\"Operator\":\"Equals\",\"Operands\":[\"ContinueLooping\"]}}]},\"Type\":\"Loop\"},{\"Identifier\":\"b43becd2-b08d-4320-8b7f-a0eadfd42c63\",\"Parameters\":{\"LambdaFunctionARN\":\"%%INVOKE_TELEPHONY_FUNCTION_ARN%%\",\"InvocationTimeLimitSeconds\":\"8\",\"LambdaInvocationAttributes\":{\"methodName\":\"createTransferVC\"}},\"Transitions\":{\"NextAction\":\"a84eafe1-3bf5-4d37-bf24-4d17623bebf5\",\"Errors\":[{\"NextAction\":\"1cfe732c-ec05-4708-bb79-5c3480b0e873\",\"ErrorType\":\"NoMatchingError\"}],\"Conditions\":[]},\"Type\":\"InvokeLambdaFunction\"}]}",
    "Tags": {}
  }
}
