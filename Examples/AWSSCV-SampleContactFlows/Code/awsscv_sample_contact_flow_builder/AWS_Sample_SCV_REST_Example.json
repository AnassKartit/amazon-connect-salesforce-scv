{"modules":[{"id":"187adae0-cc83-4bdb-9b8a-f0ff150a5b82","type":"SetLoggingBehavior","branches":[{"condition":"Success","transition":"30d06461-311f-41fb-ab57-a05ad5faa806"}],"parameters":[{"name":"LoggingBehavior","value":"Enable"}],"metadata":{"position":{"x":29,"y":180}}},{"id":"30d06461-311f-41fb-ab57-a05ad5faa806","type":"SetRecordingBehavior","branches":[{"condition":"Success","transition":"a8a03893-5fcb-4bac-9bfd-34942f5ffafd"}],"parameters":[{"name":"RecordingBehaviorOption","value":"Disable"},{"name":"RecordingParticipantOption","value":"Both"}],"metadata":{"position":{"x":26.935991287231445,"y":390.39801025390625}}},{"id":"a8a03893-5fcb-4bac-9bfd-34942f5ffafd","type":"SetEventHook","branches":[{"condition":"Success","transition":"95250467-054d-4e52-89d0-bf70b513dc07"},{"condition":"Error","transition":"95250467-054d-4e52-89d0-bf70b513dc07"}],"parameters":[{"name":"Type","value":"AgentWhisper"},{"name":"ContactFlowId","value":"arn:aws:connect:us-west-2:376407789201:instance/ddfe75a7-69da-4613-a3bb-6f500094182f/contact-flow/a9fb2d29-5a07-4403-93b2-aeb1d5033001","resourceName":"AWSSCVAgentWhisperWithStreaming"}],"metadata":{"position":{"x":28.45675277709961,"y":575.930908203125},"contactFlow":{"id":"arn:aws:connect:us-west-2:376407789201:instance/ddfe75a7-69da-4613-a3bb-6f500094182f/contact-flow/a9fb2d29-5a07-4403-93b2-aeb1d5033001","text":"AWSSCVAgentWhisperWithStreaming"},"customerOrAgent":false,"useDynamic":false}},{"id":"95250467-054d-4e52-89d0-bf70b513dc07","type":"PlayPrompt","branches":[{"condition":"Success","transition":"1906df8a-1d18-490b-99c7-40d369c134f8"}],"parameters":[{"name":"Text","value":"Thank you for calling. All calls may be monitored for quality assurance.","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":345,"y":46},"useDynamic":false}},{"id":"33a66342-ff9d-4c20-9809-f4d98de99172","type":"Disconnect","branches":[],"parameters":[],"metadata":{"position":{"x":1148,"y":317}}},{"id":"6c71edb3-c065-4791-9260-5936e8f21def","type":"PlayPrompt","branches":[{"condition":"Success","transition":"33a66342-ff9d-4c20-9809-f4d98de99172"}],"parameters":[{"name":"Text","value":"I'm sorry. We have encountered an error and cannot currently handle your call. Please try back later. We apologize for any inconvenience. Goodbye.","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":908,"y":319},"useDynamic":false}},{"id":"132adca9-0003-4236-a4b6-798409698f3b","type":"SetAttributes","branches":[{"condition":"Success","transition":"6c71edb3-c065-4791-9260-5936e8f21def"},{"condition":"Error","transition":"6c71edb3-c065-4791-9260-5936e8f21def"}],"parameters":[{"name":"Attribute","value":"lambda loop fail","key":"error_desc","namespace":null},{"name":"Attribute","value":"true","key":"process_error","namespace":null}],"metadata":{"position":{"x":662,"y":320}}},{"id":"1906df8a-1d18-490b-99c7-40d369c134f8","type":"Loop","branches":[{"condition":"Looping","transition":"6188311e-8772-4235-a028-ed7491ac8f7f"},{"condition":"Complete","transition":"132adca9-0003-4236-a4b6-798409698f3b"}],"parameters":[{"name":"LoopCount","value":"2"}],"metadata":{"position":{"x":604,"y":44},"useDynamic":false}},{"id":"6188311e-8772-4235-a028-ed7491ac8f7f","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"e6710a0b-8bde-4c2c-8956-3a4a1c17ffbd"},{"condition":"Error","transition":"1906df8a-1d18-490b-99c7-40d369c134f8"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeTelephonyIntegrationApiFunction","namespace":null},{"name":"TimeLimit","value":"8"},{"name":"Parameter","key":"methodName","value":"createVoiceCall","namespace":null}],"metadata":{"position":{"x":1386,"y":418},"dynamicMetadata":{"methodName":false},"useDynamic":false},"target":"Lambda"},{"id":"37ceeec2-6d83-45a5-ba47-f715f8fcff02","type":"PlayPrompt","branches":[{"condition":"Success","transition":"eb8dba75-2f19-4d21-93d7-c1afa138491c"}],"parameters":[{"name":"Text","value":"One moment please","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":2764.206556754527,"y":31.44894409179686},"useDynamic":false}},{"id":"eb8dba75-2f19-4d21-93d7-c1afa138491c","type":"SetAttributes","branches":[{"condition":"Success","transition":"df1328a8-6400-40fd-99a2-e47f7f0ffdfa"},{"condition":"Error","transition":"df1328a8-6400-40fd-99a2-e47f7f0ffdfa"}],"parameters":[{"name":"Attribute","value":"Id","key":"case_id","namespace":"External"},{"name":"Attribute","value":"Subject","key":"sfdc-issue__c","namespace":"External"}],"metadata":{"position":{"x":3020,"y":34.999999999999986}}},{"id":"df1328a8-6400-40fd-99a2-e47f7f0ffdfa","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"d0ee6be8-06e4-4a86-93b0-3d06ae20029f"},{"condition":"Error","transition":"d0ee6be8-06e4-4a86-93b0-3d06ae20029f"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeSalesforceRestApiFunction","namespace":null},{"name":"TimeLimit","value":"8"},{"name":"Parameter","key":"methodName","value":"updateRecord","namespace":null},{"name":"Parameter","key":"recordId","value":"voiceCallId","namespace":"User Defined"},{"name":"Parameter","key":"RelatedRecordId","value":"case_id","namespace":"User Defined"},{"name":"Parameter","key":"objectApiName","value":"VoiceCall","namespace":null}],"metadata":{"position":{"x":3313,"y":39},"dynamicMetadata":{"methodName":false,"recordId":true,"RelatedRecordId":true,"objectApiName":false},"useDynamic":false},"target":"Lambda"},{"id":"4b332312-240f-4370-970a-8fdf98a7e883","type":"GetUserInput","branches":[{"condition":"Evaluate","conditionType":"Equals","conditionValue":"1","transition":"37ceeec2-6d83-45a5-ba47-f715f8fcff02"},{"condition":"Timeout","transition":"e798f239-69ad-4495-9c0f-58a84d76de32"},{"condition":"NoMatch","transition":"e798f239-69ad-4495-9c0f-58a84d76de32"},{"condition":"Error","transition":"e798f239-69ad-4495-9c0f-58a84d76de32"}],"parameters":[{"name":"Text","value":"<speak>If you are calling about open case <say-as interpret-as=\"digits\">$.External.CaseNumber</say-as>, regarding $.External.Subject, press 1. Otherwise, press 3.</speak>","namespace":null},{"name":"TextToSpeechType","value":"ssml"},{"name":"Timeout","value":"5"},{"name":"MaxDigits","value":"1"}],"metadata":{"position":{"x":2516.3224014810894,"y":33.999999999999986},"conditionMetadata":[{"id":"0f70a0d6-fa6f-4162-802c-b6c5d2e6f149","value":"1"}],"useDynamic":false},"target":"Digits"},{"id":"f3560fba-6e49-4d58-b277-78a5f3ff306d","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"1c6803ab-60a8-4857-ba5c-cce6cded9c08"},{"condition":"Error","transition":"e798f239-69ad-4495-9c0f-58a84d76de32"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeSalesforceRestApiFunction","namespace":null},{"name":"TimeLimit","value":"8"},{"name":"Parameter","key":"methodName","value":"queryRecord","namespace":null},{"name":"Parameter","key":"soql","value":"SELECT Id,Subject,CaseNumber FROM Case WHERE ContactPhone = '$.CustomerEndpoint.Address' AND IsClosed = false","namespace":null}],"metadata":{"position":{"x":2013,"y":219},"dynamicMetadata":{"methodName":false,"soql":false},"useDynamic":false},"target":"Lambda"},{"id":"1c6803ab-60a8-4857-ba5c-cce6cded9c08","type":"CheckAttribute","branches":[{"condition":"Evaluate","conditionType":"Contains","conditionValue":"500","transition":"4b332312-240f-4370-970a-8fdf98a7e883"},{"condition":"NoMatch","transition":"e798f239-69ad-4495-9c0f-58a84d76de32"}],"parameters":[{"name":"Attribute","value":"Id"},{"name":"Namespace","value":"External"}],"metadata":{"position":{"x":2252.3224014810894,"y":30.999999999999986},"conditionMetadata":[{"id":"17f5b661-b7d1-4741-b58a-17745b8ee56d","operator":{"name":"Contains","value":"Contains","shortDisplay":"contains"},"value":"500"}]}},{"id":"e798f239-69ad-4495-9c0f-58a84d76de32","type":"PlayPrompt","branches":[{"condition":"Success","transition":"5f06a241-7ea2-47da-aecf-fa4d7acc2e70"}],"parameters":[{"name":"Text","value":"Please hold for the next available representative.","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":2255.3224014810894,"y":431},"useDynamic":false}},{"id":"e6710a0b-8bde-4c2c-8956-3a4a1c17ffbd","type":"SetAttributes","branches":[{"condition":"Success","transition":"f3560fba-6e49-4d58-b277-78a5f3ff306d"},{"condition":"Error","transition":"520b7639-29e3-43fa-bc1e-b5a7455f7ffc"}],"parameters":[{"name":"Attribute","value":"voiceCallId","key":"voiceCallId","namespace":"External"}],"metadata":{"position":{"x":1638,"y":46}}},{"id":"520b7639-29e3-43fa-bc1e-b5a7455f7ffc","type":"SetAttributes","branches":[{"condition":"Success","transition":"1c9b6cea-cb39-4679-9cf6-2c03eb39b55e"},{"condition":"Error","transition":"1c9b6cea-cb39-4679-9cf6-2c03eb39b55e"}],"parameters":[{"name":"Attribute","value":"set voiceObjectId failed","key":"error_desc","namespace":null},{"name":"Attribute","value":"true","key":"process_error","namespace":null}],"metadata":{"position":{"x":1673,"y":423.5620437956204}}},{"id":"df5e1a6b-7f30-436a-a051-bf9fe006053d","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"f48a1a56-f749-4207-a355-941d9a391e28"},{"condition":"Error","transition":"77020edc-de39-4a64-ae1a-a2ebdaa4d64e"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeSalesforceRestApiFunction","namespace":null},{"name":"TimeLimit","value":"3"},{"name":"Parameter","key":"methodName","value":"createRecord","namespace":null},{"name":"Parameter","key":"objectApiName","value":"Contact","namespace":null},{"name":"Parameter","key":"Phone","value":"Customer Number","namespace":"System"},{"name":"Parameter","key":"LastName","value":"Unknown","namespace":null}],"metadata":{"position":{"x":3317,"y":549.5620437956204},"dynamicMetadata":{"methodName":false,"objectApiName":false,"Phone":true,"LastName":false},"useDynamic":false},"target":"Lambda"},{"id":"1c9b6cea-cb39-4679-9cf6-2c03eb39b55e","type":"PlayPrompt","branches":[{"condition":"Success","transition":"80a080c2-a708-462a-8a8c-1104f4afb35d"}],"parameters":[{"name":"Text","value":"I'm sorry. We have encountered an error and cannot currently handle your call. Please try back later. We apologize for any inconvenience. Goodbye.","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":2129,"y":1003.5620437956204},"useDynamic":false}},{"id":"80a080c2-a708-462a-8a8c-1104f4afb35d","type":"Disconnect","branches":[],"parameters":[],"metadata":{"position":{"x":4640,"y":635.5620437956204}}},{"id":"34b03f4b-f066-49f0-815d-adb27fd1d758","type":"Transfer","branches":[{"condition":"AtCapacity","transition":"80a080c2-a708-462a-8a8c-1104f4afb35d"},{"condition":"Error","transition":"80a080c2-a708-462a-8a8c-1104f4afb35d"}],"parameters":[],"metadata":{"position":{"x":4377.866821289062,"y":559.7207657194485},"useDynamic":false,"queue":null},"target":"Queue"},{"id":"d0ee6be8-06e4-4a86-93b0-3d06ae20029f","type":"PlayPrompt","branches":[{"condition":"Success","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"}],"parameters":[{"name":"Text","value":"Transferring to queue.","namespace":null},{"name":"TextToSpeechType","value":"text"}],"metadata":{"position":{"x":3577.489501953125,"y":39},"useDynamic":false}},{"id":"77020edc-de39-4a64-ae1a-a2ebdaa4d64e","type":"SetAttributes","branches":[{"condition":"Success","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"},{"condition":"Error","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"}],"parameters":[{"name":"Attribute","value":"contact creation failed","key":"error_desc","namespace":null},{"name":"Attribute","value":"true","key":"process_error","namespace":null}],"metadata":{"position":{"x":3561,"y":819.5620437956204}}},{"id":"4ef7094e-d09f-4c39-875a-158d5515c197","type":"SetQueue","branches":[{"condition":"Success","transition":"34b03f4b-f066-49f0-815d-adb27fd1d758"},{"condition":"Error","transition":"34b03f4b-f066-49f0-815d-adb27fd1d758"}],"parameters":[{"name":"Queue","value":"arn:aws:connect:us-west-2:376407789201:instance/ddfe75a7-69da-4613-a3bb-6f500094182f/queue/25c2f0df-327f-4945-aee3-fbf43d4a73c7","namespace":null,"resourceName":"BasicQueue"}],"metadata":{"position":{"x":4088,"y":557.5620437956204},"useDynamic":false,"queue":{"id":"arn:aws:connect:us-west-2:376407789201:instance/ddfe75a7-69da-4613-a3bb-6f500094182f/queue/25c2f0df-327f-4945-aee3-fbf43d4a73c7","text":"BasicQueue"}}},{"id":"5f06a241-7ea2-47da-aecf-fa4d7acc2e70","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"54d9d698-b2b6-4ce1-8bac-e55cdfd63bb4"},{"condition":"Error","transition":"9228040f-f012-460c-abd2-3117bbef5d1d"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeSalesforceRestApiFunction","namespace":null},{"name":"TimeLimit","value":"3"},{"name":"Parameter","key":"methodName","value":"queryRecord","namespace":null},{"name":"Parameter","key":"soql","value":"SELECT Id FROM Contact where Phone = '$.CustomerEndpoint.Address'","namespace":null}],"metadata":{"position":{"x":2528,"y":458.5620437956204},"dynamicMetadata":{"methodName":false,"soql":false},"useDynamic":false},"target":"Lambda"},{"id":"54d9d698-b2b6-4ce1-8bac-e55cdfd63bb4","type":"SetAttributes","branches":[{"condition":"Success","transition":"d47e2c22-67d1-477f-8eea-49cf6172fda5"},{"condition":"Error","transition":"9228040f-f012-460c-abd2-3117bbef5d1d"}],"parameters":[{"name":"Attribute","value":"Id","key":"ContactId","namespace":"External"}],"metadata":{"position":{"x":2800,"y":303.5620437956204}}},{"id":"f6548f04-2cb2-467b-87e8-09a9550b05f2","type":"SetAttributes","branches":[{"condition":"Success","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"},{"condition":"Error","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"}],"parameters":[{"name":"Attribute","value":"recordId","key":"CaseId","namespace":"External"}],"metadata":{"position":{"x":3776,"y":305.5620437956204}}},{"id":"9228040f-f012-460c-abd2-3117bbef5d1d","type":"SetAttributes","branches":[{"condition":"Success","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"},{"condition":"Error","transition":"4ef7094e-d09f-4c39-875a-158d5515c197"}],"parameters":[{"name":"Attribute","value":"case creation failed","key":"error_desc","namespace":null},{"name":"Attribute","value":"true","key":"process_error","namespace":null}],"metadata":{"position":{"x":2821,"y":926.5620437956204}}},{"id":"d47e2c22-67d1-477f-8eea-49cf6172fda5","type":"CheckAttribute","branches":[{"condition":"Evaluate","conditionType":"Contains","conditionValue":"003","transition":"dc7c0ddf-3d1b-4bd2-b490-187e33b87173"},{"condition":"NoMatch","transition":"df5e1a6b-7f30-436a-a051-bf9fe006053d"}],"parameters":[{"name":"Attribute","value":"ContactId"},{"name":"Namespace","value":"User Defined"}],"metadata":{"position":{"x":3043,"y":305.5620437956204},"conditionMetadata":[{"id":"ddb0aa10-b93b-4d14-8c08-25e639a98028","operator":{"name":"Contains","value":"Contains","shortDisplay":"contains"},"value":"003"}]}},{"id":"f48a1a56-f749-4207-a355-941d9a391e28","type":"SetAttributes","branches":[{"condition":"Success","transition":"dc7c0ddf-3d1b-4bd2-b490-187e33b87173"},{"condition":"Error","transition":"77020edc-de39-4a64-ae1a-a2ebdaa4d64e"}],"parameters":[{"name":"Attribute","value":"recordId","key":"ContactId","namespace":"External"}],"metadata":{"position":{"x":3564,"y":549.5620437956204}}},{"id":"dc7c0ddf-3d1b-4bd2-b490-187e33b87173","type":"InvokeExternalResource","branches":[{"condition":"Success","transition":"f6548f04-2cb2-467b-87e8-09a9550b05f2"},{"condition":"Error","transition":"9228040f-f012-460c-abd2-3117bbef5d1d"}],"parameters":[{"name":"FunctionArn","value":"arn:aws:lambda:us-west-2:376407789201:function:SCV08112020-InvokeSalesforceRestApiFunction","namespace":null},{"name":"TimeLimit","value":"3"},{"name":"Parameter","key":"methodName","value":"createRecord","namespace":null},{"name":"Parameter","key":"objectApiName","value":"Case","namespace":null},{"name":"Parameter","key":"amazonconnect__AC_Contact_Id__c","value":"ContactId","namespace":"System"},{"name":"Parameter","key":"Description","value":"This case was created automatically by Amazon Connect","namespace":null},{"name":"Parameter","key":"ContactId","value":"ContactId","namespace":"User Defined"}],"metadata":{"position":{"x":3446,"y":288},"dynamicMetadata":{"methodName":false,"objectApiName":false,"amazonconnect__AC_Contact_Id__c":true,"Description":false,"ContactId":true},"useDynamic":false},"target":"Lambda"}],"version":"1","type":"contactFlow","start":"187adae0-cc83-4bdb-9b8a-f0ff150a5b82","metadata":{"entryPointPosition":{"x":15,"y":15},"snapToGrid":false,"name":"AWS_Sample_SCV_REST_Example","description":"Combines both REST examples from Salesforce. Corrects prompts to make them more realistic. Incorproates a loop around the Telephony Integration Lambda. Adds validation prompts and dynamic messaging. Combines the case lookup  and case linking sections","type":"contactFlow","status":"saved","hash":"b8d25f2c0356d9bb8ec3302c9699f34569f65113aed301ae7c7d16551682790c"}}